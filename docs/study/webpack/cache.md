---
title: âš™ï¸webpackæŒä¹…åŒ–ç¼“å­˜
description: é€šè¿‡WebpackæŒä¹…åŒ–ç¼“å­˜ï¼Œå¤§å¹…æå‡æ„å»ºæ€§èƒ½
date: 2024-10-18
tag:
 - webpack
---

# Webpackä¸­çš„æŒä¹…åŒ–ç¼“å­˜

æŒä¹…åŒ–ç¼“å­˜ç®—å¾—ä¸Šæ˜¯ Webpack 5 æœ€ä»¤äººæŒ¯å¥‹çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒèƒ½å¤Ÿå°†é¦–æ¬¡æ„å»ºçš„è¿‡ç¨‹ä¸ç»“æœæ•°æ®æŒä¹…åŒ–ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œ
åœ¨ä¸‹æ¬¡æ‰§è¡Œæ„å»ºæ—¶è·³è¿‡è§£æã€é“¾æ¥ã€ç¼–è¯‘ç­‰ä¸€ç³»åˆ—éå¸¸æ¶ˆè€—æ€§èƒ½çš„æ“ä½œï¼Œç›´æ¥å¤ç”¨ä¸Šæ¬¡çš„ Module/ModuleGraph/Chunk å¯¹è±¡æ•°æ®ï¼Œè¿…é€Ÿæ„å»ºå‡ºæœ€ç»ˆäº§ç‰©

## è®¾ç½®æŒä¹…åŒ–ç¼“å­˜

ä»…ä»…éœ€è¦è®¾ç½® `cache.type = 'filesystem'` å³å¯å¼€å¯æŒä¹…åŒ–ç¼“å­˜
```js
module.exports = {
    //...
    cache: {
        type: 'filesystem'
    },
    //...
};
```

`cache` é…ç½®é¡¹: 
+ `cache.type`ï¼šç¼“å­˜ç±»å‹ï¼Œæ”¯æŒ `'memory' | 'filesystem'`ï¼Œéœ€è¦è®¾ç½®ä¸º `filesystem` æ‰èƒ½å¼€å¯æŒä¹…ç¼“å­˜
+ `cache.cacheDirectory`ï¼šç¼“å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸º `node_modules/.cache/webpack`
+ `cache.buildDependencies`ï¼šé¢å¤–çš„ä¾èµ–æ–‡ä»¶ï¼Œå½“è¿™äº›æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç¼“å­˜ä¼šå®Œå…¨å¤±æ•ˆè€Œæ‰§è¡Œå®Œæ•´çš„ç¼–è¯‘æ„å»ºï¼Œé€šå¸¸å¯è®¾ç½®ä¸ºå„ç§é…ç½®æ–‡ä»¶
+ `cache.managedPaths`ï¼šå—æ§ç›®å½•ï¼ŒWebpack æ„å»ºæ—¶ä¼šè·³è¿‡æ–°æ—§ä»£ç å“ˆå¸Œå€¼ä¸æ—¶é—´æˆ³çš„å¯¹æ¯”ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜å‰¯æœ¬ï¼Œé»˜è®¤å€¼ä¸º `['./node_modules']`
+ `cache.profile`ï¼šæ˜¯å¦è¾“å‡ºç¼“å­˜å¤„ç†è¿‡ç¨‹çš„è¯¦ç»†æ—¥å¿—ï¼Œé»˜è®¤ä¸º `false`
+ `cache.maxAge`ï¼šç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º `5184000000`


## ç¼“å­˜åŸç†

Webpack5 ä¼šå°†é¦–æ¬¡æ„å»ºå‡ºçš„ Moduleã€Chunkã€ModuleGraph ç­‰å¯¹è±¡åºåˆ—åŒ–åä¿å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œåé¢å†è¿è¡Œçš„æ—¶å€™ï¼Œå°±å¯ä»¥è·³è¿‡è®¸å¤šè€—æ—¶çš„ç¼–è¯‘åŠ¨ä½œï¼Œç›´æ¥å¤ç”¨ç¼“å­˜æ•°æ®

Webpackçš„æ„å»ºè¿‡ç¨‹ï¼š
+ åˆå§‹åŒ–ï¼šæ ¹æ®é…ç½®ä¿¡æ¯è®¾ç½®å†…ç½®çš„å„ç±»æ’ä»¶
+ Make-æ„å»ºé˜¶æ®µï¼Œä» `entry` æ¨¡å—å¼€å§‹ï¼Œæ‰§è¡Œï¼š
  + è¯»å…¥æ–‡ä»¶å†…å®¹
  + è°ƒç”¨ Loader è½¬è¯‘æ–‡ä»¶å†…å®¹
  + è°ƒç”¨ acorn ç”ŸæˆASTç»“æ„
  + åˆ†æ AST ï¼Œç¡®å®šæ¨¡å—ä¾èµ–åˆ—è¡¨
  + éå†æ¨¡å—ä¾èµ–åˆ—è¡¨ï¼Œå¯¹æ¯ä¸€ä¸ªæ¨¡å—é‡æ–°æ‰§è¡Œä¸Šè¿°æµç¨‹ï¼Œç›´åˆ°ç”Ÿæˆå®Œæ•´çš„æ¨¡å—ä¾èµ–å›¾â€”â€”ModuleGraphå¯¹è±¡
+ Seal-ç”Ÿæˆé˜¶æ®µï¼Œè¿‡ç¨‹ï¼š
  + éå†æ¨¡å—ä¾èµ–å›¾ï¼Œå¯¹æ¯ä¸ªæ¨¡å—æ‰§è¡Œï¼š
    + ä»£ç è½¬è¯‘ï¼Œå¦‚ `import` è½¬æ¢ä¸º `require` è°ƒç”¨
    + åˆ†æè¿è¡Œæ—¶ä¾èµ–
  + åˆå¹¶æ¨¡å—ä»£ç ä¸è¿è¡Œæ—¶ä»£ç ï¼Œç”Ÿæˆ chunk
  + æ‰§è¡Œäº§ç‰©ä¼˜åŒ–æ“ä½œï¼Œå¦‚ Tree-shaking
  + å°†æœ€ç»ˆç»“æœå†™å‡ºåˆ°äº§ç‰©æ–‡ä»¶

è¿‡ç¨‹ä¸­å­˜åœ¨è®¸å¤š CPU å¯†é›†å‹æ“ä½œï¼Œä¾‹å¦‚è°ƒç”¨ Loader é“¾åŠ è½½æ–‡ä»¶æ—¶ï¼Œé‡åˆ° `babel-loader`ã€`eslint-loader`ã€`ts-loader` ç­‰å·¥å…·æ—¶å¯èƒ½éœ€è¦é‡å¤ç”Ÿæˆ ASTï¼›åˆ†ææ¨¡å—ä¾èµ–æ—¶åˆ™éœ€è¦éå† ASTï¼Œæ‰§è¡Œå¤§é‡è¿ç®—ï¼›Seal é˜¶æ®µä¹ŸåŒæ ·å­˜åœ¨å¤§é‡ AST éå†ï¼Œä»¥åŠä»£ç è½¬æ¢ã€ä¼˜åŒ–æ“ä½œï¼Œç­‰ç­‰ã€‚å‡è®¾ä¸šåŠ¡é¡¹ç›®ä¸­æœ‰ 1000 ä¸ªæ–‡ä»¶ï¼Œåˆ™æ¯æ¬¡æ‰§è¡Œ `npx webpack` å‘½ä»¤æ—¶ï¼Œéƒ½éœ€è¦ä» 0 å¼€å§‹æ‰§è¡Œ 1000 æ¬¡æ„å»ºã€ç”Ÿæˆé€»è¾‘ã€‚

è€Œ Webpack5 çš„æŒä¹…åŒ–ç¼“å­˜åŠŸèƒ½åˆ™å°†æ„å»ºç»“æœä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨ä¸‹æ¬¡ç¼–è¯‘æ—¶å¯¹æ¯”æ¯ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å“ˆå¸Œæˆ–æ—¶é—´æˆ³ï¼Œæœªå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶è·³è¿‡ç¼–è¯‘æ“ä½œï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜å‰¯æœ¬ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼›å‘ç”Ÿå˜æ›´çš„æ¨¡å—åˆ™é‡æ–°æ‰§è¡Œç¼–è¯‘æµç¨‹

Webpack åœ¨é¦–æ¬¡æ„å»ºå®Œæ¯•åå°† Moduleã€Chunkã€ModuleGraph ä¸‰ç±»å¯¹è±¡çš„çŠ¶æ€åºåˆ—åŒ–å¹¶è®°å½•åˆ°ç¼“å­˜æ–‡ä»¶ä¸­ï¼›åœ¨ä¸‹æ¬¡æ„å»ºå¼€å§‹æ—¶ï¼Œå°è¯•è¯»å…¥å¹¶æ¢å¤è¿™äº›å¯¹è±¡çš„çŠ¶æ€ï¼Œä»è€Œè·³è¿‡æ‰§è¡Œ Loader é“¾ã€è§£æ ASTã€è§£æä¾èµ–ç­‰è€—æ—¶æ“ä½œï¼Œæå‡ç¼–è¯‘æ€§èƒ½

## Webpack4ç¼“å­˜

Webpack5 çš„æŒä¹…åŒ–ç¼“å­˜ç”¨æ³•ç®€å•ï¼Œæ•ˆæœå‡ºä¼—ï¼Œä½†å¯æƒœåœ¨ Webpack4 åŠä¹‹å‰ç‰ˆæœ¬åŸç”Ÿè¿˜æ²¡æœ‰ç›¸å…³å®ç°ï¼Œåªèƒ½å€ŸåŠ©ä¸€äº›ç¬¬ä¸‰æ–¹ç»„ä»¶å®ç°ç±»ä¼¼æ•ˆæœ

+ ä½¿ç”¨ `cache-loader`: é’ˆå¯¹ Loader è¿è¡Œç»“æœçš„é€šç”¨ç¼“å­˜æ–¹æ¡ˆ
+ ä½¿ç”¨ `hard-source-webpack-plugin`: é’ˆå¯¹ Webpack å…¨ç”Ÿå‘½å‘¨æœŸçš„é€šç”¨ç¼“å­˜æ–¹æ¡ˆ
+ ä½¿ç”¨  Loaderï¼ˆå¦‚ `babel-loader`ã€`eslint-loader`ï¼‰è‡ªå¸¦çš„ç¼“å­˜èƒ½åŠ›


## ä½¿ç”¨ç»„ä»¶è‡ªå¸¦çš„ç¼“å­˜åŠŸèƒ½

å¯ä»¥ä½¿ç”¨ Webpack ç»„ä»¶è‡ªå¸¦çš„ç¼“å­˜èƒ½åŠ›æå‡ç‰¹å®šé¢†åŸŸçš„ç¼–è¯‘æ€§èƒ½ï¼Œè¿™ä¸€ç±»ç»„ä»¶æœ‰ï¼š
+ babel-loader: é’ˆå¯¹ Babel å·¥å…·çš„ä¸“ç”¨ç¼“å­˜èƒ½åŠ›
+ eslint-loader/eslint-webpack-plugin: é’ˆå¯¹ ESLint çš„ä¸“ç”¨ç¼“å­˜æ–¹æ¡ˆ
+ stylelint-webpack-plugin: é’ˆå¯¹ StyleLint çš„ä¸“ç”¨ç¼“å­˜æ–¹æ¡ˆ

> æ€è€ƒğŸ¤”ï¼šæŒä¹…åŒ–ç¼“å­˜å¾ˆå¥½ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯é»˜è®¤å¼€å¯ï¼Ÿä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ
> å¯ä»¥çœ‹çœ‹ğŸ‘‰[å®˜æ–¹æ–‡æ¡£](https://github.com/webpack/changelog-v5/blob/master/guides/persistent-caching.md)